<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Mister White Game</title>

<style>
:root {
    --bg: #121212;
    --card: #1E1E1E;
    --accent: #00D4A6;
    --text: #EAEAEA;
    --danger: #FF4D4D;
}

body {
    font-family: 'Arial', sans-serif;
    background-color: var(--bg);
    color: var(--text);
    text-align: center;
    margin: 0;
    padding: 20px;
}

h2 {
    color: var(--accent);
    margin-bottom: 10px;
}

input, input[type=number] {
    width: 90%;
    padding: 12px;
    border-radius: 10px;
    border: none;
    margin: 10px 0;
    font-size: 18px;
    text-align: center;
}

.card {
    background: var(--card);
    padding: 20px;
    border-radius: 15px;
    max-width: 450px;
    margin: 20px auto;
    box-shadow: 0 0 15px rgba(0, 212, 166, 0.25);
}

button {
    width: 90%;
    max-width: 300px;
    padding: 15px;
    font-size: 18px;
    font-weight: bold;
    margin-top: 15px;
    border: none;
    border-radius: 12px;
    cursor: pointer;
    background-color: var(--accent);
    color: black;
    transition: transform 0.2s, opacity 0.2s;
}

button:active {
    transform: scale(0.95);
    opacity: 0.8;
}

#roleScreen, #intermediateScreen, #finalScreen, #wordManagerScreen {
    display: none;
}

#roleText {
    font-size: 26px;
    margin-top: 20px;
    color: var(--accent);
    font-weight: bold;
}

ul {
    list-style-type: none;
    padding-left: 0;
}

ul li {
    padding: 5px 0;
}
ul li button {
    background: var(--danger);
    color: white;
    margin-left: 10px;
    padding: 3px 8px;
    font-size: 14px;
    border-radius: 5px;
}
</style>
</head>
<body>

<h2>Mister White Game</h2>

<!-- Schermata iniziale -->
<div class="card" id="setupScreen">
    <p>Inserisci i nomi dei giocatori (separati da virgola):</p>
    <input type="text" id="playerNames" placeholder="Luca, Marco, Giulia...">
    <p>Numero di Mister White:</p>
    <input type="number" id="numWhite" value="1" min="0">
    <p>Numero di Infiltrati:</p>
    <input type="number" id="numInfiltrati" value="1" min="0">
    <button onclick="startGame()">üé≤ Inizia la partita</button>
    <button onclick="openWordManager()">üìù Gestisci parole</button>
</div>

<!-- Schermata ruoli -->
<div class="card" id="roleScreen">
    <h3 id="currentPlayer"></h3>
    <button id="showRoleBtn" onclick="showRole()">Mostra ruolo üîç</button>
    <p id="roleText" style="display:none;"></p>
    <button id="nextPlayerBtn" onclick="nextPlayer()" style="display:none;">Giocatore successivo ‚û°Ô∏è</button>
</div>

<!-- Schermata intermedia dopo tutti i ruoli -->
<div class="card" id="intermediateScreen">
    <p>Tutti hanno visto il proprio ruolo!</p>
    <button onclick="showFinalScreen()">‚û°Ô∏è Mostra riepilogo</button>
</div>

<!-- Schermata riepilogo finale -->
<div class="card" id="finalScreen">
    <h3>Riepilogo</h3>
    <p id="summaryText"></p>
    <button onclick="restartGame()">üîÑ Nuova partita</button>
</div>

<!-- Schermata gestione parole -->
<div class="card" id="wordManagerScreen">
    <h3>Lista parole gioco</h3>
    <ul id="wordList"></ul>
    <input type="text" id="newMainWord" placeholder="Parola principale">
    <input type="text" id="newInfiltratorWord" placeholder="Parola infiltrato">
    <button onclick="addWordToList()">‚ûï Aggiungi parola</button>
    <br><br>
    <button onclick="closeWordManager()">Chiudi</button>
</div>

<script>
// --- Variabili globali ---
let players = [];
let roles = []; // ruoli dei giocatori
let currentWords = []; // parole assegnate per giocatori
let currentIndex = 0;
let savedPlayerNames = "";

// Lista parole default: ogni parola principale ha una parola infiltrato
const defaultWords = [
    {main: "Pizza", infiltrato: "Pasta"},
    {main: "Roma", infiltrato: "Milano"},
    {main: "Drago", infiltrato: "Serpente"},
    {main: "Acqua", infiltrato: "Latte"},
    {main: "Aereo", infiltrato: "Elicottero"},
    {main: "Telefono", infiltrato: "Tablet"},
    {main: "Cinema", infiltrato: "Teatro"},
    {main: "Squalo", infiltrato: "Delfino"},
    {main: "Montagna", infiltrato: "Collina"},
    {main: "Robot", infiltrato: "Droni"},
    {main: "Gelato", infiltrato: "Sorbetto"},
    {main: "Torre", infiltrato: "Castello"},
    {main: "Occhiali", infiltrato: "Maschera"},
    {main: "Luna", infiltrato: "Sole"},
    {main: "Farfalla", infiltrato: "Mosca"}
];

// Carica parole da localStorage o default
let randomWords = JSON.parse(localStorage.getItem('gameWords')) || defaultWords.slice();

// --- Funzioni gestione parole ---
function openWordManager() {
    document.getElementById("setupScreen").style.display = "none";
    document.getElementById("wordManagerScreen").style.display = "block";
    renderWordList();
}

function renderWordList() {
    const ul = document.getElementById("wordList");
    ul.innerHTML = "";
    randomWords.forEach((w, i) => {
        const li = document.createElement("li");
        li.textContent = `Main: ${w.main} | Infiltrato: ${w.infiltrator || w.infiltrado || w.infiltrator}`;
        const delBtn = document.createElement("button");
        delBtn.textContent = "‚úñÔ∏è";
        delBtn.onclick = () => { removeWord(i); };
        li.appendChild(delBtn);
        ul.appendChild(li);
    });
}

function addWordToList() {
    const main = document.getElementById("newMainWord").value.trim();
    const infiltrator = document.getElementById("newInfiltratorWord").value.trim();
    if(main && infiltrator) {
        randomWords.push({main, infiltrator});
        localStorage.setItem('gameWords', JSON.stringify(randomWords));
        document.getElementById("newMainWord").value = "";
        document.getElementById("newInfiltratorWord").value = "";
        renderWordList();
    } else {
        alert("Inserisci entrambe le parole!");
    }
}

function removeWord(index) {
    randomWords.splice(index, 1);
    localStorage.setItem('gameWords', JSON.stringify(randomWords));
    renderWordList();
}

function closeWordManager() {
    document.getElementById("wordManagerScreen").style.display = "none";
    document.getElementById("setupScreen").style.display = "block";
}

// --- Funzioni gioco ---
function startGame() {
    players = document.getElementById("playerNames")
        .value.split(",")
        .map(p => p.trim())
        .filter(p => p);

    const numWhite = parseInt(document.getElementById("numWhite").value) || 0;
    const numInfiltrati = parseInt(document.getElementById("numInfiltrati").value) || 0;

    if(players.length < 2) {
        alert("Minimo 2 giocatori!");
        return;
    }
    if(numWhite + numInfiltrati > players.length) {
        alert("Numero di ruoli superiore al numero di giocatori!");
        return;
    }

    savedPlayerNames = players.join(", ");

    // Reset ruoli e parole
    roles = [];
    currentWords = [];

    // Assegna Mister White
    let tempPlayers = [...players];
    for(let i=0;i<numWhite;i++){
        const idx = Math.floor(Math.random()*tempPlayers.length);
        roles.push({name: tempPlayers[idx], role: "Mister White"});
        tempPlayers.splice(idx,1);
    }

    // Assegna Infiltrati
    for(let i=0;i<numInfiltrati;i++){
        const idx = Math.floor(Math.random()*tempPlayers.length);
        roles.push({name: tempPlayers[idx], role: "Infiltrato"});
        tempPlayers.splice(idx,1);
    }

    // Assegna giocatori normali
    tempPlayers.forEach(p=>{
        roles.push({name: p, role: "Normale"});
    });

    // Mischia i ruoli
    roles = roles.sort(() => Math.random()-0.5);

    // Assegna parole
    roles.forEach(r=>{
        if(r.role === "Normale") {
            const rand = randomWords[Math.floor(Math.random()*randomWords.length)];
            currentWords.push(rand.main);
        } else if(r.role === "Infiltrato") {
            const rand = randomWords[Math.floor(Math.random()*randomWords.length)];
            currentWords.push(rand.infiltrator);
        } else {
            currentWords.push(""); // Mister White non vede parola
        }
    });

    currentIndex = 0;
    document.getElementById("setupScreen").style.display = "none";
    document.getElementById("finalScreen").style.display = "none";
    document.getElementById("intermediateScreen").style.display = "none";
    document.getElementById("roleScreen").style.display = "block";

    updatePlayerScreen();
}

function updatePlayerScreen() {
    document.getElementById("currentPlayer").innerText =
        "Turno di: " + roles[currentIndex].name;

    document.getElementById("roleText").style.display = "none";
    document.getElementById("showRoleBtn").style.display = "block";
    document.getElementById("nextPlayerBtn").style.display = "none";
}

function showRole() {
    const r = roles[currentIndex];
    let roleText = "";
    if(r.role === "Mister White") roleText = "‚ùì SEI MISTER WHITE! ‚ùì";
    else if(r.role === "Infiltrato") roleText = `Parola (infiltrato): ${currentWords[currentIndex]}`;
    else roleText = `Parola: ${currentWords[currentIndex]}`;

    document.getElementById("roleText").innerText = roleText;
    document.getElementById("roleText").style.display = "block";
    document.getElementById("showRoleBtn").style.display = "none";
    document.getElementById("nextPlayerBtn").style.display = "block";
}

function nextPlayer() {
    currentIndex++;
    if(currentIndex >= roles.length) {
        document.getElementById("roleScreen").style.display = "none";
        document.getElementById("intermediateScreen").style.display = "block";
    } else {
        updatePlayerScreen();
    }
}

function showFinalScreen() {
    document.getElementById("intermediateScreen").style.display = "none";
    document.getElementById("finalScreen").style.display = "block";

    const summary = roles.map((r,i)=>{
        let word = r.role === "Mister White" ? "-" : currentWords[i];
        return `${r.name} - ${r.role} - ${word}`;
    }).join("<br>");

    document.getElementById("summaryText").innerHTML = summary;
}

function restartGame() {
    players = [];
    roles = [];
    currentWords = [];
    currentIndex = 0;

    document.getElementById("playerNames").value = savedPlayerNames;
    document.getElementById("finalScreen").style.display = "none";
    document.getElementById("intermediateScreen").style.display = "none";
    document.getElementById("roleScreen").style.display = "none";
    document.getElementById("setupScreen").style.display = "block";
}
</script>

</body>
</html>
