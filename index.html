<!DOCTYPE html>
<html lang="it">
<head>
<!-- Manifest PWA -->
<link rel="manifest" href="manifest.json">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="apple-touch-icon" href="icon-192.png">

<meta charset="UTF-8">
<title>Mister White Game</title>

<style>
    :root {
        --main-bg: #222;
        --card-bg: #333;
        --accent: #4CAF50;
        --danger: #c0392b;
        --text: #fff;
    }
    body {
        margin: 0;
        background: var(--main-bg);
        color: var(--text);
        font-family: Arial, sans-serif;
        text-align: center;
    }
    .screen {
        display: none;
        padding: 20px;
    }
    button {
        padding: 10px 18px;
        margin: 10px;
        border: none;
        border-radius: 8px;
        background: var(--accent);
        color: white;
        font-size: 16px;
        cursor: pointer;
    }
    button.danger { background: var(--danger); }
    input {
        padding: 10px;
        margin: 5px;
        width: 80%;
        max-width: 300px;
        border-radius: 6px;
        border: none;
    }
    ul { list-style: none; padding: 0; }
    li {
        margin: 8px 0;
        padding: 10px;
        background: var(--card-bg);
        border-radius: 6px;
    }
    ul li button {
        background: var(--danger);
        color: white;
        margin-left: 10px;
        padding: 5px 10px;
        font-size: 14px;
        border-radius: 6px;
        cursor: pointer;
    }
</style>
</head>

<body>

<div id="startScreen" class="screen" style="display:block;">
    <h1>Mister White</h1>
    <p>Inserisci i nomi dei giocatori (separati da virgole)</p>
    <input id="nameInput" placeholder="Es: Luca, Marco, Sara">
    <p>Numero Mister White:</p>
    <input id="numWhite" type="number" min="0" value="1">
    <p>Numero Infiltrati:</p>
    <input id="numInfiltrati" type="number" min="0" value="1">
    <button onclick="startGame()">Inizia</button>
    <br>
    <button onclick="openWordManager()">Gestione Parole</button>
</div>

<div id="roleScreen" class="screen">
    <h2 id="playerName"></h2>
    <button id="showRoleBtn" onclick="showRole()">Mostra</button>
    <p id="roleText" style="display:none;font-size:24px;font-weight:bold;"></p>
    <button id="nextPlayerBtn" onclick="nextPlayer()" style="display:none;">Avanti</button>
</div>

<div id="readyScreen" class="screen">
    <h2>TUTTI HANNO VISTO IL RUOLO</h2>
    <p>Quando siete pronti...</p>
    <button onclick="showSummary()">Inizia Discussione</button>
</div>

<div id="summaryScreen" class="screen">
    <h2>Riepilogo</h2>
    <ul id="summaryList"></ul>
    <button onclick="restart()">Nuova Partita</button>
</div>

<div id="wordManager" class="screen">
    <h2>Gestione Parole</h2>
    <ul id="wordList"></ul>
    <hr>
    <h3>Aggiungi nuova parola</h3>
    <input id="addMain" placeholder="Parola principale">
    <input id="addInfil" placeholder="Parola infiltrato">
    <button onclick="addWord()">Aggiungi</button>
    <br><br>
    <button onclick="closeWordManager()">Fine</button>
</div>

<script>
/* ======================================
   PAROLE DI DEFAULT
====================================== */
const defaultWords = [
    {main:"Pizza", infiltrator:"Pasta"},
    {main:"Roma", infiltrator:"Milano"},
    {main:"Drago", infiltrator:"Serpente"},
    {main:"Acqua", infiltrator:"Latte"},
    {main:"Aereo", infiltrator:"Elicottero"},
    {main:"Telefono", infiltrator:"Tablet"},
    {main:"Cinema", infiltrator:"Teatro"},
    {main:"Squalo", infiltrator:"Delfino"},
    {main:"Montagna", infiltrator:"Collina"},
    {main:"Robot", infiltrator:"Drone"},
    {main:"Gelato", infiltrator:"Sorbetto"},
    {main:"Torre", infiltrator:"Castello"},
    {main:"Occhiali", infiltrator:"Maschera"},
    {main:"Luna", infiltrator:"Sole"},
    {main:"Farfalla", infiltrator:"Mosca"}
];

/* ======================================
   CARICAMENTO / SALVATAGGIO PAROLE
====================================== */
let storedWords = JSON.parse(localStorage.getItem("gameWords"));
let randomWords = storedWords ?
    storedWords.map(w=>({main:w.main, infiltrator:w.infiltrator||""})) :
    [...defaultWords];

/* ======================================
   VARIABILI DI GIOCO
====================================== */
let names = [];
let roles = [];
let currentWords = [];
let currentIndex = 0;

/* ======================================
   FUNZIONI DI GIOCO
====================================== */
function startGame() {
    const rawNames = document.getElementById("nameInput").value;
    names = rawNames.split(",").map(n=>n.trim()).filter(n=>n.length>0);

    const w = parseInt(document.getElementById("numWhite").value);
    const i = parseInt(document.getElementById("numInfiltrati").value);

    if(names.length === 0) return alert("Aggiungi dei giocatori!");
    if(w + i > names.length) return alert("Troppi ruoli speciali!");

    const word = randomWords[Math.floor(Math.random()*randomWords.length)];

    const allRoles = [];
    for(let x=0;x<w;x++) allRoles.push("Mister White");
    for(let x=0;x<i;x++) allRoles.push("Infiltrato");
    while(allRoles.length < names.length) allRoles.push("Normale");

    roles = shuffle(allRoles).map((r,index)=>({
        name: names[index],
        role: r
    }));

    currentWords = roles.map(r=>{
        if(r.role==="Mister White") return "❌ Nessuna parola";
        if(r.role==="Infiltrato") return word.infiltrator;
        return word.main;
    });

    currentIndex = 0;
    showScreen("roleScreen");
    updateRoleScreen();
}

function updateRoleScreen() {
    document.getElementById("playerName").innerText = names[currentIndex];
    document.getElementById("roleText").style.display = "none";
    document.getElementById("nextPlayerBtn").style.display = "none";
    document.getElementById("showRoleBtn").style.display = "block";
}

function showRole() {
    const r = roles[currentIndex];
    let roleText = "";

    if(r.role === "Mister White"){
        roleText = "❓ SEI MISTER WHITE!";
    } else {
        roleText = "Parola: " + currentWords[currentIndex];
    }

    document.getElementById("roleText").innerText = roleText;
    document.getElementById("roleText").style.display = "block";
    document.getElementById("showRoleBtn").style.display = "none";
    document.getElementById("nextPlayerBtn").style.display = "block";
}

function nextPlayer() {
    currentIndex++;
    if(currentIndex >= names.length) {
        showScreen("readyScreen");
    } else {
        updateRoleScreen();
    }
}

function showSummary() {
    const ul = document.getElementById("summaryList");
    ul.innerHTML = "";
    roles.forEach(r=>{
        const li = document.createElement("li");
        li.innerText = `${r.name} → ${r.role}`;
        ul.appendChild(li);
    });
    showScreen("summaryScreen");
}

function restart() {
    showScreen("startScreen");
}

/* ======================================
   GESTIONE PAROLE
====================================== */
function openWordManager() {
    showScreen("wordManager");
    renderWordList();
}

function renderWordList() {
    const list = document.getElementById("wordList");
    list.innerHTML = "";
    randomWords.forEach((w,i)=>{
        const li = document.createElement("li");
        li.innerText = `${w.main} → ${w.infiltrator}`;
        const btn = document.createElement("button");
        btn.innerText = "Rimuovi";
        btn.onclick = ()=>{ removeWord(i); };
        li.appendChild(btn);
        list.appendChild(li);
    });
}

function removeWord(i) {
    randomWords.splice(i,1);
    saveWords();
    renderWordList();
}

function addWord() {
    const m = document.getElementById("addMain").value.trim();
    const inf = document.getElementById("addInfil").value.trim();
    if(!m || !inf) return alert("Inserisci entrambe le parole!");
    randomWords.push({main:m, infiltrator:inf});
    saveWords();
    document.getElementById("addMain").value = "";
    document.getElementById("addInfil").value = "";
    renderWordList();
}

function closeWordManager() {
    showScreen("startScreen");
}

function saveWords() {
    localStorage.setItem("gameWords", JSON.stringify(randomWords));
}

/* ======================================
   UTIL
====================================== */
function showScreen(id) {
    document.querySelectorAll(".screen").forEach(s=>s.style.display="none");
    document.getElementById(id).style.display = "block";
}

function shuffle(a) {
    return a.sort(()=>Math.random()-0.5);
}

</script>
</body>
</html>

