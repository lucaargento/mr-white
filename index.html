<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="manifest" href="manifest.json">

<meta name="theme-color" content="#00D4A6">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<link rel="apple-touch-icon" href="icon-192.png">

<script>
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("service-worker.js");
}
</script>

<title>Mister White Game</title>

<style>
:root {
    --bg: #121212;
    --card: #1E1E1E;
    --accent: #00D4A6;
    --text: #EAEAEA;
    --danger: #FF4D4D;
}

body {
    font-family: 'Arial', sans-serif;
    background-color: var(--bg);
    color: var(--text);
    text-align: center;
    margin: 0;
    padding: 20px;
    width: 100vw;
    height: 100vh;
    overflow-x: hidden;
    -webkit-overflow-scrolling: touch;
}

h2 {
    color: var(--accent);
    margin-bottom: 10px;
}

input, input[type=number] {
    display: block;
    margin: 10px auto;
    width: 90%;
    padding: 12px;
    border-radius: 10px;
    border: none;
    font-size: 18px;
    text-align: center;
    -webkit-user-select: text;
    user-select: text;
    touch-action: manipulation;
}

.card {
    position: relative;
    background: var(--card);
    padding: 20px;
    border-radius: 15px;
    max-width: 450px;
    margin: 20px auto;
    box-shadow: 0 0 15px rgba(0, 212, 166, 0.25);
}

button {
    width: 90%;
    max-width: 300px;
    padding: 15px;
    font-size: 18px;
    font-weight: bold;
    margin-top: 15px;
    border: none;
    border-radius: 12px;
    cursor: pointer;
    background-color: var(--accent);
    color: black;
    transition: transform 0.2s, opacity 0.2s;
}

button:active {
    transform: scale(0.95);
    opacity: 0.8;
}

#roleScreen, #intermediateScreen, #finalScreen, #wordManagerScreen {
    display: none;
}

#roleText {
    font-size: 26px;
    margin-top: 20px;
    color: var(--accent);
    font-weight: bold;
}

ul {
    list-style-type: none;
    padding-left: 0;
}

ul li {
    padding: 5px 0;
}
ul li button {
    background: var(--danger);
    color: white;
    margin-left: 10px;
    padding: 3px 8px;
    font-size: 14px;
    border-radius: 5px;
}
</style>
</head>
<body>

<h2>Mister White Game</h2>

<div class="card" id="setupScreen">
    <p>Inserisci i nomi dei giocatori (separati da virgola):</p>
    <input type="text" id="playerNames" placeholder="Luca, Marco, Giulia...">
    <p>Numero di Mister White:</p>
    <input type="number" id="numWhite" value="1" min="0">
    <p>Numero di Infiltrati:</p>
    <input type="number" id="numInfiltrati" value="1" min="0">
    <button onclick="startGame()">üé≤ Inizia la partita</button>
    <button onclick="openWordManager()">üìù Gestisci parole</button>
</div>

<div class="card" id="roleScreen">
    <h3 id="currentPlayer"></h3>
    <button id="showRoleBtn" onclick="showRole()">Mostra ruolo üîç</button>
    <p id="roleText" style="display:none;"></p>
    <button id="nextPlayerBtn" onclick="nextPlayer()" style="display:none;">Giocatore successivo ‚û°Ô∏è</button>
</div>

<div class="card" id="intermediateScreen">
    <p>Tutti hanno visto il proprio ruolo!</p>
    <button onclick="showFinalScreen()">‚û°Ô∏è Mostra riepilogo</button>
</div>

<div class="card" id="finalScreen">
    <h3>Riepilogo</h3>
    <p id="summaryText"></p>
    <button onclick="restartGame()">üîÑ Nuova partita</button>
</div>

<div class="card" id="wordManagerScreen">
    <h3>Lista parole gioco</h3>
    <ul id="wordList"></ul>
    <input type="text" id="newMainWord" placeholder="Parola principale">
    <input type="text" id="newInfiltratorWord" placeholder="Parola infiltrato">
    <button onclick="addWordToList()">‚ûï Aggiungi parola</button>
    <br><br>
    <button onclick="closeWordManager()">Chiudi</button>
</div>

<script>
// --- Variabili gioco ---
let players=[], roles=[], currentWords=[], currentIndex=0, savedPlayerNames="";
const defaultWords=[{main:"Pizza",infiltrator:"Pasta"},{main:"Roma",infiltrator:"Milano"},{main:"Drago",infiltrator:"Serpente"},{main:"Acqua",infiltrator:"Latte"},{main:"Aereo",infiltrator:"Elicottero"},{main:"Telefono",infiltrator:"Tablet"},{main:"Cinema",infiltrator:"Teatro"},{main:"Squalo",infiltrator:"Delfino"},{main:"Montagna",infiltrator:"Collina"},{main:"Robot",infiltrator:"Droni"},{main:"Gelato",infiltrator:"Sorbetto"},{main:"Torre",infiltrator:"Castello"},{main:"Occhiali",infiltrator:"Maschera"},{main:"Luna",infiltrator:"Sole"},{main:"Farfalla",infiltrator:"Mosca"}];

let storedWords = JSON.parse(localStorage.getItem('gameWords'));
let randomWords = storedWords && storedWords.length>0 ? storedWords.map(w=>({main:w.main||"",infiltrator:w.infiltrator||w.infiltrato||""})) : defaultWords.slice();

// --- Gestione parole ---
function openWordManager(){document.getElementById("setupScreen").style.display="none";document.getElementById("wordManagerScreen").style.display="block";renderWordList();}
function renderWordList(){const ul=document.getElementById("wordList");ul.innerHTML="";randomWords.forEach((w,i)=>{const li=document.createElement("li");li.textContent=`Main: ${w.main} | Infiltrato: ${w.infiltrator}`;const delBtn=document.createElement("button");delBtn.textContent="Rimuovi";delBtn.onclick=()=>{removeWord(i)};li.appendChild(delBtn);ul.appendChild(li);});}
function addWordToList(){const main=document.getElementById("newMainWord").value.trim();const infiltrator=document.getElementById("newInfiltratorWord").value.trim();if(main && infiltrator){randomWords.push({main,infiltrator});localStorage.setItem('gameWords',JSON.stringify(randomWords));document.getElementById("newMainWord").value="";document.getElementById("newInfiltratorWord").value="";renderWordList();}else{alert("Inserisci entrambe le parole!");}}
function removeWord(i){randomWords.splice(i,1);localStorage.setItem('gameWords',JSON.stringify(randomWords));renderWordList();}
function closeWordManager(){document.getElementById("wordManagerScreen").style.display="none";document.getElementById("setupScreen").style.display="block";}

// --- Funzioni gioco ---
function startGame(){players=document.getElementById("playerNames").value.split(",").map(p=>p.trim()).filter(p=>p);const numWhite=parseInt(document.getElementById("numWhite").value)||0;const numInfiltrati=parseInt(document.getElementById("numInfiltrati").value)||0;if(players.length<2){alert("Minimo 2 giocatori!");return;}if(numWhite+numInfiltrati>players.length){alert("Numero di ruoli superiore al numero di giocatori!");return;}savedPlayerNames=players.join(", ");roles=[];currentWords=[];let tempPlayers=[...players];for(let i=0;i<numWhite;i++){const idx=Math.floor(Math.random()*tempPlayers.length);roles.push({name:tempPlayers[idx],role:"Mister White"});tempPlayers.splice(idx,1);}for(let i=0;i<numInfiltrati;i++){const idx=Math.floor(Math.random()*tempPlayers.length);roles.push({name:tempPlayers[idx],role:"Infiltrato"});tempPlayers.splice(idx,1);}tempPlayers.forEach(p=>{roles.push({name:p,role:"Normale"});});roles.sort(()=>Math.random()-0.5);const chosenWordPair=randomWords[Math.floor(Math.random()*randomWords.length)];roles.forEach(r=>{currentWords.push(r.role==="Normale"?chosenWordPair.main:r.role==="Infiltrato"?chosenWordPair.infiltrator:"");});currentIndex=0;document.getElementById("setupScreen").style.display="none";document.getElementById("finalScreen").style.display="none";document.getElementById("intermediateScreen").style.display="none";document.getElementById("roleScreen").style.display="block";updatePlayerScreen();}
function updatePlayerScreen(){document.getElementById("currentPlayer").innerText="Turno di: "+roles[currentIndex].name;document.getElementById("roleText").style.display="none";document.getElementById("showRoleBtn").style.display="block";document.getElementById("nextPlayerBtn").style.display="none";}
function showRole(){const r=roles[currentIndex];let roleText="";if(r.role==="Mister White")roleText="‚ùì SEI MISTER WHITE! ‚ùì";else roleText=`Parola: ${currentWords[currentIndex]}`;document.getElementById("roleText").innerText=roleText;document.getElementById("roleText").style.display="block";document.getElementById("showRoleBtn").style.display="none";document.getElementById("nextPlayerBtn").style.display="block";}
function nextPlayer(){currentIndex++;if(currentIndex>=roles.length){document.getElementById("roleScreen").style.display="none";document.getElementById("intermediateScreen").style.display="block";}else{updatePlayerScreen();}}
function showFinalScreen(){document.getElementById("intermediateScreen").style.display="none";document.getElementById("finalScreen").style.display="block";const summary=roles.map((r,i)=>{let word=r.role==="Mister White"? "-":currentWords[i];return `${r.name} - ${r.role} - ${word}`;}).join("<br>");document.getElementById("summaryText").innerHTML=summary;}
function restartGame(){players=[];roles=[];currentWords=[];currentIndex=0;document.getElementById("playerNames").value=savedPlayerNames;document.getElementById("finalScreen").style.display="none";document.getElementById("intermediateScreen").style.display="none";document.getElementById("roleScreen").style.display="none";document.getElementById("setupScreen").style.display="block";}

// --- Fix PWA iOS input ---
function iosInputFix(){
  const isIOS=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream;
  if(!isIOS) return;
  const inputs=document.querySelectorAll('input');
  inputs.forEach(input=>{
    input.addEventListener('focus',()=>{
      document.body.style.position='absolute';
      setTimeout(()=>{input.scrollIntoView({behavior:'smooth',block:'center'});},300);
    });
    input.addEventListener('blur',()=>{
      document.body.style.position='relative';
    });
  });
}
document.addEventListener('DOMContentLoaded', iosInputFix);
</script>

</body>
</html>
